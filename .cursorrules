# Project Rules for AI Assistants

## Project Overview
This is **eTrener** - an interactive educational platform for quizzes, fitness workouts, and language learning.

**Tech Stack**: HTML5, Tailwind CSS, Vanilla JavaScript (ES6+), Supabase, JSDoc
**Developer Tools**: JSDoc type safety, DOM helpers, IntelliSense support, Reactive state management

## ğŸ“ File Organization Rules

### Documentation Files
**IMPORTANT**: All documentation files (`.md` files) MUST be placed in the `/docs/` directory, with the following exceptions:
- `README.md` - MUST stay in the project root
- `LICENSE` - MUST stay in the project root

When creating new documentation:
- âœ… Place in `/docs/` directory
- âœ… Use descriptive, UPPERCASE names with underscores (e.g., `FEATURE_NAME.md`)
- âŒ DO NOT create `.md` files in the project root (except README.md)

### Project Structure
```
/
â”œâ”€â”€ README.md                  # Main project documentation (ROOT ONLY)
â”œâ”€â”€ LICENSE                    # License file (ROOT ONLY)
â”œâ”€â”€ index.html                 # Main application page
â”œâ”€â”€ generate-manifest.js       # Manifest generator script
â”‚
â”œâ”€â”€ /docs/                     # ğŸ“š ALL DOCUMENTATION FILES GO HERE
â”‚   â”œâ”€â”€ PRD.md
â”‚   â”œâ”€â”€ TECH_STACK.md
â”‚   â”œâ”€â”€ DATA_FORMAT.md
â”‚   â”œâ”€â”€ STATE_MANAGEMENT.md
â”‚   â”œâ”€â”€ IMPLEMENTATION_PLAN.md
â”‚   â””â”€â”€ ... (all other .md files)
â”‚
â”œâ”€â”€ /data/
â”‚   â”œâ”€â”€ manifest.json          # Generated file list
â”‚   â”œâ”€â”€ /quizzes/              # Quiz JSON files
â”‚   â””â”€â”€ /workouts/             # Workout JSON files
â”‚
â”œâ”€â”€ /js/
â”‚   â”œâ”€â”€ app.js                 # Main application logic
â”‚   â”œâ”€â”€ state-manager.js       # Reactive store (pub/sub)
â”‚   â”œâ”€â”€ ui-state.js            # UI state manager
â”‚   â”œâ”€â”€ ui-manager.js          # View management
â”‚   â”œâ”€â”€ quiz-engine.js         # Quiz logic
â”‚   â”œâ”€â”€ workout-engine.js      # Workout logic
â”‚   â”œâ”€â”€ listening-engine.js    # TTS/listening logic
â”‚   â”œâ”€â”€ audio.js               # Sound generation
â”‚   â”œâ”€â”€ dom-helpers.js         # DOM manipulation helpers
â”‚   â””â”€â”€ types.js               # JSDoc type definitions
â”‚
â”œâ”€â”€ /api/                      # API endpoints (Vercel serverless)
â”‚   â”œâ”€â”€ ai-generate.js         # AI content generation
â”‚   â””â”€â”€ config.js              # API configuration
â”‚
â”œâ”€â”€ /scripts/                  # Build/utility scripts
â”‚   â””â”€â”€ generate-config.js
â”‚
â”œâ”€â”€ /supabase/                 # Database schema and migrations
â”‚   â”œâ”€â”€ schema.sql
â”‚   â””â”€â”€ *.sql
â”‚
â””â”€â”€ /__tests__/                # Jest test files
    â””â”€â”€ *.test.js
```

## ğŸ¯ Coding Standards

### JavaScript
- Use **ES6+ syntax** (const/let, arrow functions, async/await)
- Use **JSDoc** for type annotations (see `js/types.js` for type definitions)
- Follow **functional programming** principles where possible
- Use **DOM helpers** from `js/dom-helpers.js` instead of raw DOM manipulation
- All new modules should export typed functions with JSDoc comments

### State Management
- Use `state-manager.js` for reactive state (pub/sub pattern)
- Use `ui-state.js` for UI state management
- Subscribe to state changes instead of polling
- See `/docs/STATE_MANAGEMENT.md` for full documentation

### DOM Manipulation
- **ALWAYS** use helpers from `js/dom-helpers.js`:
  - `$(selector)` - Query single element
  - `$$(selector)` - Query multiple elements
  - `create(tag, props, children)` - Create elements
  - `show(el)`, `hide(el)` - Toggle visibility
  - `addClass()`, `removeClass()`, `toggleClass()` - Class manipulation
- See `/docs/DOM_HELPERS_EXAMPLES.md` for examples

### Data Formats
- Quiz and workout data must follow formats in `/docs/DATA_FORMAT.md`
- All JSON files must include emoji icons (see `/docs/DATA_FORMAT_EMOJI_UPDATE.md`)
- Run `node generate-manifest.js` after adding new data files

## ğŸ”§ Development Workflow

### Before Making Changes
1. Read relevant documentation from `/docs/` directory
2. Check `js/types.js` for type definitions
3. Review existing code patterns

### After Making Changes
1. Update JSDoc comments if function signatures change
2. Update relevant documentation in `/docs/` if behavior changes
3. **ALWAYS write tests** for new functionality: `npm test`
4. Regenerate manifest if data files changed: `node generate-manifest.js`

### Creating New Features
1. Create implementation plan in `/docs/IMPLEMENTATION_PLAN_[FEATURE].md`
2. Update `js/types.js` with new type definitions
3. Implement feature with proper JSDoc annotations
4. **WRITE TESTS FIRST or alongside implementation** in `__tests__/`
5. Update main documentation in `/docs/`

### Testing Philosophy
- **Test-Driven Development (TDD)**: Write tests before or during implementation
- **Test Coverage**: Aim for high coverage of business logic
- **Test Types**:
  - Unit tests for individual functions
  - Integration tests for feature workflows
  - Edge case testing for robustness
- **Test Location**: All tests go in `__tests__/` directory
- **Test Naming**: `feature-name.test.js` or `component-name.test.js`
- **Run Tests**: `npm test` before committing changes

## ğŸ“š Key Documentation Files

When working on specific areas, refer to these docs:
- **Data formats**: `/docs/DATA_FORMAT.md`
- **State management**: `/docs/STATE_MANAGEMENT.md`
- **DOM helpers**: `/docs/DOM_HELPERS_EXAMPLES.md`, `/docs/QUICK_START_DOM_HELPERS.md`
- **Type system**: `/docs/JSDOC_TYPESCRIPT_SUMMARY.md`
- **TypeScript migration**: `/docs/TYPESCRIPT_MIGRATION.md`
- **Database schema**: `/docs/DB_SCHEMA.md`
- **Deployment**: `/docs/DEPLOYMENT.md`, `/docs/VERCEL_SETUP.md`
- **Feature flags**: `/docs/FEATURE_FLAGS.md`
- **AI generation**: `/docs/AI_GENERATOR_DEBUG.md`
- **TTS feature**: `/docs/TTS_FEATURE.md`

## ğŸš« Don't Do This
- âŒ Create `.md` files in project root (except README.md)
- âŒ Use raw DOM manipulation (use `dom-helpers.js`)
- âŒ Mutate state directly (use state manager)
- âŒ Skip JSDoc annotations
- âŒ Forget to update manifest after adding data files
- âŒ Use `var` (use `const` or `let`)
- âŒ Create inline styles (use Tailwind classes)

## âœ… Do This
- âœ… Place all documentation in `/docs/`
- âœ… Use DOM helpers for all DOM operations
- âœ… Use state manager for reactive state
- âœ… Add JSDoc comments to all functions
- âœ… Follow existing code patterns
- âœ… Update relevant documentation when making changes
- âœ… Write tests for new features
- âœ… Use Tailwind CSS for styling

## ğŸ” Quick Reference

### Creating Documentation
```bash
# Create new documentation file
touch docs/NEW_FEATURE.md

# NOT like this:
touch NEW_FEATURE.md  # âŒ Wrong location!
```

### Adding Quiz/Workout
```bash
# 1. Create JSON file
touch data/quizzes/my-quiz.json

# 2. Edit with proper format (see /docs/DATA_FORMAT.md)

# 3. Generate manifest
node generate-manifest.js
```

### Working with State
```javascript
// Subscribe to state changes
const unsubscribe = uiState.subscribe((state, prevState) => {
  console.log('State changed:', state);
});

// Navigate to screen
uiState.navigateToScreen('quiz');

// Update state
uiState.setListeningPlayerActive(true);
```

## ğŸŒ Language
- Code comments: English
- Documentation: Polish (for user-facing docs) or English (for technical docs)
- Variable/function names: English
- UI text: Polish

---

**Remember**: This project values clean code, proper documentation, and maintainability. When in doubt, check existing patterns in the codebase or relevant documentation in `/docs/`.

